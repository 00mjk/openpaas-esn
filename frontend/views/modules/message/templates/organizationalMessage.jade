div(ng-class="{'just-posted': message._id === lastPost.messageId, 'esn-panel': parentMessage, 'thread': parentMessage}")
  a.pull-left.message-avatar(href='#')
    img.media-object(src='/images/user.png', ng-src='/api/users/{{::message.author._id}}/profile/avatar')
  div.media-body
    div
      h3.media-heading(ng-if='parentMessage') {{::message.title}}
      h4.media-heading
        i.fa.fa-envelope.message-source-email(ng-show='message.source === "email"', title='sent via email reply')
        a(href="#") {{::message.author.firstname}} {{::message.author.lastname}}
        small(ng-if='isInternalUser')
          span &nbsp;#{__('to')}&nbsp;
          span.message-span-company(ng-if='!message.recipients || message.recipients.length === 0') #{__('all recipients')}
          ul.list-inline.nomargin.message-recipients-list(ng-if='message.recipients && message.recipients.length !== 0')
            li.nopadding(ng-repeat="companyTuple in message.recipients")
              span(ng-show='!$first && $last') &nbsp;#{__('and')}&nbsp;
              span(ng-show='!$first && !$last') ,&nbsp;
              span.message-span-company {{::companyTuple.id}}
        a.message-date(href="/#messages/{{::message._id}}/activitystreams/{{::activitystream.activity_stream.uuid}}")
          small {{::message.published | amDateFormat:'MMM D YY, h:mm a'}}
      activity-stream-origin(ng-if='parentMessage && !message.isOrigin', streams='message.streamOrigins')
      display-position(position='message.position')
      p.multilines
        text-parser(parsers='{{::message.parsers}}', text='{{::message.content}}')
      .row

    include ./includes/messagesBottomLinks
    include ./includes/attachments.jade
    include ./includes/oembed.jade

    div(ng-if='parentMessage && isInternalUser')
      ul.nav.nav-pills.message-recipients-nav
        li(ng-class='{active: allSelected, disabled: loading}')
          a(ng-click='selectCompany()', href='') #{__('All')}
        li(ng-repeat='companyTuple in message.recipients' ng-class='{active: companySelected === companyTuple.id, disabled: loading}')
          a(ng-click='selectCompany(companyTuple.id)', href='') {{::companyTuple.id}}

    include ./includes/comments.jade
